var Fe=Object.defineProperty;var De=(a,e,t)=>e in a?Fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var g=(a,e,t)=>(De(a,typeof e!="symbol"?e+"":e,t),t);import{_ as ze}from"./ComponentPage.vue_vue_type_script_setup_true_name_ComponentPage_lang.da812460.js";import{U as v,V as m,W as o,d as Z,a as D,S as Y,k as y,X as x,F as A,N as M,r as ve,c as me,x as L,v as P,l as _,a1 as N,a4 as O,Z as ne,M as fe,ah as Ee,a2 as ee,o as $,b as ie}from"./vue.71710d55.js";import{_ as U,N as re,b2 as we,h as xe,j as Te}from"./NvapForm.32ab4956.js";import{l as B}from"./lodash.cbea5afb.js";import"./AppPage.vue_vue_type_script_setup_true_name_AppPage_lang.083a423a.js";import"./vue-router.37441a91.js";import"./axios.9678a311.js";const Be={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ne=[o("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5"},[o("path",{d:"M8 9s1-1 4-1s4 1 4 1"}),o("path",{fill:"currentColor",d:"M12 14a1 1 0 1 0 0-2a1 1 0 0 0 0 2Z"}),o("path",{d:"M5 18L3.13 4.913a.996.996 0 0 1 .774-1.114l7.662-1.703a2 2 0 0 1 .868 0L20.096 3.8c.51.113.848.596.774 1.114L19 18c-.07.495-.5 3.5-7 3.5S5.07 18.495 5 18Z"})],-1)],He={name:"iconoir-shield-eye",render:function(a,e){return v(),m("svg",Be,Ne)}},Ye={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ue=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M12 8v7m0 0l3-3m-3 3l-3-3m-4 6L3.13 4.913a.996.996 0 0 1 .774-1.114l7.662-1.703a2 2 0 0 1 .868 0L20.096 3.8c.51.113.848.596.774 1.114L19 18c-.07.495-.5 3.5-7 3.5S5.07 18.495 5 18Z"},null,-1)],Ve={name:"iconoir-shield-download",render:function(a,e){return v(),m("svg",Ye,Ue)}},je=Z({name:"LayerItem",props:["board","data","index","refresh"],setup(a){const e=D(null),{board:t,refresh:l}=Y(a);return{setLayerShow:(s,i)=>{t.value&&(t.value.select.cancelSelectElement(),t.value.layer.updateShow(s,i),l.value())},updateCurrentLayer:s=>{t.value&&(t.value.layer.updateCurrent(s),l.value())},setLayerTitle:(s,i)=>{t.value&&(t.value.layer.updateTitle(s,i),l.value())},dndRef:e}}}),Ge={ref:"dndRef"},qe=["onClick"],Xe=["value","onInput"],Ze={key:0},$e={key:1},Ce=U(je,[["render",function(a,e,t,l,s,i){const n=Ve,r=He;return v(),m("div",Ge,[o("div",{flex:"","justify-evenly":"","py-1.5":"","cursor-pointer":"",onClick:()=>a.updateCurrentLayer(a.data.id)},[o("input",{value:a.data.title,"px-2":"","w-100":"",onInput:p=>a.setLayerTitle(a.data.id,p.target.value)},null,40,Xe),o("div",{onClick:e[0]||(e[0]=p=>{p.stopPropagation(),a.setLayerShow(a.data.id,!a.data.show)}),"cursor-pointer":""},[a.data.show?(v(),m("div",Ze,[y(n)])):(v(),m("div",$e,[y(r)]))])],8,qe)],512)}]]),Je={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},Ke=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9.879 14.121L12 12m2.121-2.121L12 12m0 0L9.879 9.879M12 12l2.121 2.121M21 3.6v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6Z"},null,-1)],Qe={name:"iconoir-remove-square",render:function(a,e){return v(),m("svg",Je,Ke)}},ea={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},aa=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h3m3 0h-3m0 0V9m0 3v3m9-11.4v16.8a.6.6 0 0 1-.6.6H3.6a.6.6 0 0 1-.6-.6V3.6a.6.6 0 0 1 .6-.6h16.8a.6.6 0 0 1 .6.6Z"},null,-1)],ta={name:"iconoir-add-square",render:function(a,e){return v(),m("svg",ea,aa)}},la=Z({name:"Layer",props:["board","refresh"],components:{LayerItem:Ce},setup(a){const{board:e,refresh:t}=Y(a);return{deleteLayer:l=>{e.value&&l&&(e.value.history.delete("layer",l),e.value.layer.delete(l),t.value())},addLayer:()=>{e.value&&(e.value.layer.add(),t.value())}}}}),sa={class:"mt-3"},ia={class:"font-bold flex justify-between items-center"},na=o("span",null,"Layer",-1),se=U(la,[["render",function(a,e,t,l,s,i){var d,w;const n=ta,r=re,p=Qe,h=Ce;return v(),m("div",sa,[o("div",ia,[na,o("div",null,[o("span",{onClick:e[0]||(e[0]=(...c)=>a.addLayer&&a.addLayer(...c)),class:"text-2xl cursor-pointer tooltip","data-tip":"layer.add"},[y(r,{size:"20"},{default:x(()=>[y(n)]),_:1})]),o("span",{onClick:e[1]||(e[1]=()=>{var c;return a.deleteLayer((c=a.board)==null?void 0:c.layer.current)}),class:"ml-3 mr-3 text-2xl cursor-pointer tooltip","data-tip":"layer.delete"},[y(r,{size:"20"},{default:x(()=>[y(p)]),_:1})])])]),o("div",null,[(v(!0),m(A,null,M((w=(d=a.board)==null?void 0:d.layer)==null?void 0:w.stack,(c,u)=>(v(),m("div",{key:u},[y(h,{index:u,board:a.board,data:c,refresh:a.refresh},null,8,["index","board","data","refresh"])]))),128))])])}]]),ra={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},oa=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M6 20h12M12 4v12m0 0l3.5-3.5M12 16l-3.5-3.5"},null,-1)],ke={name:"iconoir-download",render:function(a,e){return v(),m("svg",ra,oa)}},ha={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ca=[o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"m20 9l-1.995 11.346A2 2 0 0 1 16.035 22h-8.07a2 2 0 0 1-1.97-1.654L4 9m17-3h-5.625M3 6h5.625m0 0V4a2 2 0 0 1 2-2h2.75a2 2 0 0 1 2 2v2m-6.75 0h6.75"},null,-1)],be={name:"iconoir-trash",render:function(a,e){return v(),m("svg",ha,ca)}},da={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ua=[o("path",{fill:"currentColor",d:"m3 8.41l9 9l7-7V15h2V7h-8v2h4.59L12 14.59L4.41 7L3 8.41z"},null,-1)],Se={name:"ic-outline-call-missed-outgoing",render:function(a,e){return v(),m("svg",da,ua)}},pa={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},ga=[o("path",{fill:"currentColor",d:"M8 7v4L2 6l6-5v4h5a8 8 0 1 1 0 16H4v-2h9a6 6 0 1 0 0-12H8z"},null,-1)],Le={name:"ri-arrow-go-back-fill",render:function(a,e){return v(),m("svg",pa,ga)}},ya={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},va=[o("path",{fill:"currentColor",d:"M11 19v-6H5v-2h6V5h2v6h6v2h-6v6h-2Z"},null,-1)],_e={name:"material-symbols-add",render:function(a,e){return v(),m("svg",ya,va)}},ma={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},fa=[o("path",{fill:"currentColor",d:"M7.5 8v8l4-4l-4-4ZM5 21q-.825 0-1.413-.588T3 19V5q0-.825.588-1.413T5 3h14q.825 0 1.413.588T21 5v14q0 .825-.588 1.413T19 21H5Zm9-2V5H5v14h9Z"},null,-1)],Re={name:"material-symbols-right-panel-close",render:function(a,e){return v(),m("svg",ma,fa)}},Ea={class:"inline-block",viewBox:"0 0 24 24",width:"1em",height:"1em"},wa=[o("path",{fill:"currentColor",d:"m8.4 17l3.6-3.6l3.6 3.6l1.4-1.4l-3.6-3.6L17 8.4L15.6 7L12 10.6L8.4 7L7 8.4l3.6 3.6L7 15.6L8.4 17Zm3.6 5q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-2q3.35 0 5.675-2.325T20 12q0-3.35-2.325-5.675T12 4Q8.65 4 6.325 6.325T4 12q0 3.35 2.325 5.675T12 20Zm0-8Z"},null,-1)],Pe={name:"material-symbols-cancel-outline",render:function(a,e){return v(),m("svg",Ea,wa)}};var T=(a=>(a.FREE_DRAW="freeDraw",a.ERASER="eraser",a.SELECT="select",a.TEXT="text",a))(T||{});const ae={W4:4,W8:8,W12:12,W14:14};var Q=(a=>(a.SPACE="Space",a.BACKSPACE="Backspace",a))(Q||{}),E=(a=>(a.NULL="null",a.BODY="body",a.BOTTOM_LEFT="bottom_left",a.BOTTOM_RIGHT="bottom_right",a.TOP_LEFT="top_left",a.TOP_RIGHT="top_right",a))(E||{});const xa=[[{angle:5.583355774007967,radius:13.170263432613105,alpha:.05898673647592223},{angle:5.131010450992059,radius:.7817489383919507,alpha:.5100257793470147},{angle:4.636833851694653,radius:12.861021735315903,alpha:.3203035000110175},{angle:1.3610933961301914,radius:10.721630723608113,alpha:.3588266632675361},{angle:3.0980633230717873,radius:6.493227741011866,alpha:.4002193432055927},{angle:5.590449694049453,radius:27.47616089556182,alpha:.607048460674523},{angle:3.739010692716357,radius:9.061432979859308,alpha:.480859360711694},{angle:.6407704198710791,radius:14.497769251978458,alpha:.7785503449313602},{angle:3.415835325605248,radius:27.61648770129166,alpha:.4016734391069954},{angle:1.904711102699025,radius:7.013998263239804,alpha:.7684627412696294},{angle:4.547104556559523,radius:12.579653794547427,alpha:.23542534482855504},{angle:1.1632476448970976,radius:29.06059346420537,alpha:.5761388893651247},{angle:6.061298560563908,radius:8.177147362968434,alpha:.7503927290290877},{angle:4.842018785091064,radius:21.184836722786343,alpha:.9775115902028098},{angle:5.971745817531819,radius:7.7659438626131845,alpha:.48799238256139343},{angle:3.307977677708776,radius:10.987421235648732,alpha:.6950136920951413},{angle:1.930221683612943,radius:25.161173930257043,alpha:.9603567634624279},{angle:.15683541272550192,radius:1.2655126135470707,alpha:.3873092455503637},{angle:2.474341010124658,radius:.6886375242209919,alpha:.10098558334364638},{angle:.6191440220114202,radius:.17028810819351703,alpha:.7918889312802515},{angle:3.596335077888342,radius:25.390192874595275,alpha:.7358187392531155},{angle:2.4796335104209883,radius:16.062760282557626,alpha:.3785592974146792},{angle:5.5409955417365655,radius:10.427501860280884,alpha:.22740608596088063},{angle:3.9829846750737,radius:13.338267491431974,alpha:.985843203950451},{angle:3.87398014413178,radius:9.575694277961206,alpha:.41366501409525225},{angle:2.765997521115169,radius:5.7069510113408946,alpha:.7870660468405066},{angle:2.242789743931914,radius:1.5007446541580771,alpha:.5494363135816804},{angle:5.043798716830996,radius:15.068438374878504,alpha:.79420167499814},{angle:3.8631357495859,radius:8.39585448004578,alpha:.598362596674338},{angle:3.584443693304291,radius:29.4617626858271,alpha:.9956203212566723},{angle:1.9066754132734918,radius:14.370184381543309,alpha:.922054869596985},{angle:3.6078981083076727,radius:14.121250453564517,alpha:.2734158085921794},{angle:4.908622407964115,radius:4.411506610615332,alpha:.11892258942333722},{angle:2.7029268307254513,radius:25.301229912495305,alpha:.5611801400922427},{angle:3.5902721389731327,radius:8.78643872792157,alpha:.4926280559176506},{angle:1.11405511986771,radius:18.26206606835854,alpha:.38304696452739107},{angle:5.224725962041116,radius:5.6898684198728855,alpha:.8910554648867861},{angle:5.304260673629082,radius:26.722089685830838,alpha:.5803205559891806},{angle:4.0675034817098545,radius:11.104114427680948,alpha:.417836257052812},{angle:4.828111606788101,radius:20.543596759280934,alpha:.8713451274259636},{angle:3.105299969957836,radius:.48003189574804983,alpha:.7939929598341242},{angle:5.347945450282975,radius:15.283729668765112,alpha:.08457557026186491},{angle:1.0244001178941275,radius:16.575728749038454,alpha:.6619018380241517},{angle:5.99199396841209,radius:12.093648534052194,alpha:.42522072782449327},{angle:5.526363465937251,radius:10.777562270321948,alpha:.4370816746836017},{angle:.518283369229558,radius:6.699243539403326,alpha:.9014019719125859},{angle:3.682161557640434,radius:1.1239116451398745,alpha:.2934071815354429},{angle:4.414891789659709,radius:29.197150494698313,alpha:.016312993560689826},{angle:5.443557872904636,radius:3.0980614321538824,alpha:.41836114820827164},{angle:3.956241923313581,radius:7.9066176523642495,alpha:.22071157153118426}],[{angle:5.327722971061404,radius:16.66704728310371,alpha:.3341139567269755},{angle:2.0673151688352687,radius:22.653571679141816,alpha:.8482182381285706},{angle:5.72190409069814,radius:1.8611678466153347,alpha:.16471133237542812},{angle:5.960950352156388,radius:9.65290024878656,alpha:.5066342508425425},{angle:4.796013452085696,radius:22.839859131312227,alpha:.5378242172892751},{angle:4.2707574812207225,radius:29.34821915635409,alpha:.4820665340396897},{angle:5.5535627662277305,radius:20.948854106441182,alpha:.567304582211914},{angle:5.2458921900557804,radius:1.68964252239445,alpha:.28354282083746574},{angle:3.1012629064730826,radius:28.25286906007029,alpha:.9415588966918065},{angle:.23341452959845957,radius:25.78576019739036,alpha:.9108929916899542},{angle:1.5450519991597125,radius:15.116627242984853,alpha:.15866381981290578},{angle:3.466151788802218,radius:7.9073520964617945,alpha:.28163093623886737},{angle:1.797523075902176,radius:4.828280770578887,alpha:.8562272466930925},{angle:5.540645036839705,radius:8.078647234873873,alpha:.4261381366962238},{angle:5.160449925316718,radius:17.16106716288585,alpha:.5537024501514625},{angle:2.7098792602342314,radius:23.394753250134688,alpha:.5856606048291724},{angle:1.6201309343504446,radius:6.589110863843439,alpha:.028584181057809577},{angle:4.745848931103594,radius:18.364471272367346,alpha:.9705783899968226},{angle:3.202560825819173,radius:9.631047809563839,alpha:.18969367484368416},{angle:1.614096932942453,radius:29.625866005822733,alpha:.5178416043564735},{angle:3.462707681554657,radius:21.829582579853074,alpha:.6199898318838446},{angle:1.3606964429522295,radius:7.871657085531192,alpha:.16659730344500745},{angle:4.643866051804318,radius:1.6410419937883058,alpha:.07266767401539376},{angle:1.6391958174146808,radius:26.598467938572973,alpha:.6877808645993742},{angle:6.055221112918874,radius:3.067293267718878,alpha:.14915869138633409},{angle:2.2985356738126286,radius:26.97640520145293,alpha:.33924328410054594},{angle:4.40248442532687,radius:23.40715217725846,alpha:.7136178921458871},{angle:4.15414494286161,radius:21.87098137999967,alpha:.08969414471099779},{angle:.8965904494053539,radius:21.305599916912954,alpha:.15226932973447993},{angle:3.9156530284730153,radius:21.278929890602413,alpha:.37324791660659984},{angle:5.89426882325436,radius:21.486980071406023,alpha:.30635405009054395},{angle:.07470364909457676,radius:23.09155416324506,alpha:.2350605699100763},{angle:2.071260312841013,radius:4.523875622379592,alpha:.4062661058264787},{angle:5.500504328414527,radius:16.699243876341395,alpha:.8599779246068049},{angle:6.030429504600748,radius:10.765508817801692,alpha:.9656808792365028},{angle:4.046242117914018,radius:6.710230410368679,alpha:.24960978445469983},{angle:1.743824009068464,radius:19.243336425243903,alpha:.24279199406537932},{angle:5.983835408109719,radius:23.694827666211108,alpha:.39172606063899207},{angle:2.8303345173668335,radius:12.722756204172692,alpha:.1350330399904236},{angle:.44512509212942103,radius:9.968602885125431,alpha:.050455963167915785},{angle:.9230800442082093,radius:10.41690389029431,alpha:.0018580541981967347},{angle:6.251723457903577,radius:16.49699251212966,alpha:.4950830996023161},{angle:5.9149872316465535,radius:11.671896919487674,alpha:.14999852836996963},{angle:3.646517699851957,radius:11.337922171762722,alpha:.7851162239376546},{angle:1.3083639834529346,radius:12.083725705974322,alpha:.8438577104039962},{angle:3.7534001851834993,radius:2.4016797437483373,alpha:.4087742437673496},{angle:3.799522030985516,radius:13.325623923872612,alpha:.06397819290689166},{angle:.3825637460685785,radius:17.7864558649261,alpha:.47697721528346904},{angle:1.821205699517417,radius:19.124506382811926,alpha:.14157769700950484},{angle:6.002118120385213,radius:29.492512351347518,alpha:.25522641020097225}],[{angle:5.053150277911823,radius:25.09611137086537,alpha:.026401056455566785},{angle:.8746888408646716,radius:.652757151139367,alpha:.03332366734202363},{angle:2.879892737152405,radius:28.47393951151913,alpha:.8022168031644452},{angle:5.8946183943033486,radius:11.206299255151311,alpha:.18100696889041168},{angle:4.908708344267343,radius:26.508028669307734,alpha:.8811553438999067},{angle:4.957371846979237,radius:21.416307520006754,alpha:.5820479291629168},{angle:4.206974169222699,radius:16.94130665121616,alpha:.6264817247166166},{angle:4.9731634509868545,radius:7.531532646073737,alpha:.2874662593462556},{angle:5.794676764771489,radius:19.434556965911728,alpha:.3436901710009239},{angle:3.118853000035346,radius:23.269729369768278,alpha:.8725196602145002},{angle:5.975329232457657,radius:23.115219749800573,alpha:.7915681586294518},{angle:1.010724175301424,radius:25.68955500714481,alpha:.48159712986675673},{angle:3.123515852497084,radius:25.531839847116025,alpha:.18564945883325668},{angle:4.7292187380337865,radius:15.953326472727142,alpha:.06834642307167682},{angle:3.9852124387597154,radius:1.2975880549826457,alpha:.6908567070903562},{angle:3.480409320135462,radius:27.238969207743654,alpha:.7533545072191601},{angle:1.3813916936958106,radius:17.358035173507446,alpha:.9690243398197846},{angle:1.0525574536247184,radius:24.52767138943386,alpha:.9259365902494583},{angle:3.7469627749828134,radius:4.006016285535285,alpha:.24538439713914517},{angle:2.5500531704508975,radius:14.532334132270503,alpha:.44567029641465794},{angle:1.9012697648870927,radius:7.443809521766114,alpha:.8144357961379192},{angle:3.0357341819446155,radius:4.0346951652869905,alpha:.24895648959777428},{angle:2.670227203521328,radius:12.650757625495991,alpha:.3425211089489699},{angle:.22901719516349003,radius:8.849265875344711,alpha:.13616673650685107},{angle:3.83565975616784,radius:23.37483099552387,alpha:.022211834147981557},{angle:4.590523251755873,radius:29.533107019547987,alpha:.5449726342041736},{angle:2.3991639937742346,radius:11.297949098570596,alpha:.24594655603656812},{angle:4.003830664438075,radius:22.017839488717435,alpha:.7997864282169922},{angle:.390428424237554,radius:29.29760893818095,alpha:.25193246714312867},{angle:5.56106710750281,radius:9.92644773379783,alpha:.1149067484265276},{angle:2.3822153579450394,radius:10.621448104896851,alpha:.41380898014721956},{angle:.2094769360865982,radius:26.759710981210688,alpha:.42613595806845805},{angle:1.3393155920253739,radius:7.174906973922674,alpha:.48779910396865844},{angle:4.538101628817332,radius:12.441557694814039,alpha:.20600603820688046},{angle:4.022296107110039,radius:14.798673071271446,alpha:.8448272971087711},{angle:.9026162498452649,radius:21.892815906961452,alpha:.16475841527509605},{angle:2.51172123961957,radius:7.991452332903679,alpha:.044092078311482874},{angle:4.657609049537746,radius:20.928447303944925,alpha:.026683454181284594},{angle:1.1665344218510754,radius:24.719184577488654,alpha:.47831136319001133},{angle:3.8208212203083125,radius:.8659061241218935,alpha:.1091513071407686},{angle:5.858727239945807,radius:20.38626675544494,alpha:.7111669729018728},{angle:2.4519937394758955,radius:23.452105940798116,alpha:.765370179010985},{angle:1.3288087913553797,radius:6.562588705691718,alpha:.8233730629642597},{angle:2.8529388305699834,radius:2.995075278186461,alpha:.684938879181552},{angle:4.053789967072034,radius:9.852123386861543,alpha:.8401324926713751},{angle:2.5886516886760518,radius:19.04486458184917,alpha:.8989204382005083},{angle:3.6488735187369365,radius:10.73020992532722,alpha:.3871950712726937},{angle:4.66359784939522,radius:28.815472698337878,alpha:.990439380711919},{angle:.48289393762449817,radius:3.5707388122168715,alpha:.7786931742680896},{angle:1.6604320400768706,radius:8.055234257018203,alpha:.15698530486077855}],[{angle:1.198492159514137,radius:19.80190979689184,alpha:.885173854752511},{angle:1.6615821022828081,radius:4.7373947209669565,alpha:.724268405484324},{angle:.1618226833621532,radius:4.039591367257578,alpha:.15094637977607595},{angle:.7584022755116717,radius:21.964858218684725,alpha:.08511873346764331},{angle:4.294308809321144,radius:28.361890146781032,alpha:.5581100965252506},{angle:2.411820857736392,radius:5.173125572081783,alpha:.704080579042635},{angle:2.6394101508502374,radius:16.024065041522448,alpha:.2650773082486615},{angle:5.06939231650136,radius:6.253630109714683,alpha:.2921317448485039},{angle:1.2931258009266715,radius:19.093662004912083,alpha:.6321618815788972},{angle:.7363700358247809,radius:16.25381186703034,alpha:.7584058449516},{angle:1.3946645018642128,radius:5.6397585593509785,alpha:.12993647609503478},{angle:6.189109835935056,radius:28.990685334986207,alpha:.9157138919215684},{angle:1.5528388151308223,radius:16.57220486913935,alpha:.7151174569727614},{angle:3.480462879591272,radius:4.42142530433459,alpha:.1707548516615729},{angle:5.813823802699752,radius:29.699343064219434,alpha:.6979060932765437},{angle:3.481003698059546,radius:5.216778795836092,alpha:.5981285834253742},{angle:.9065014286997056,radius:2.8240644267211734,alpha:.22300589358303635},{angle:1.166403680180195,radius:13.199209210449736,alpha:.948908529156256},{angle:1.8099316453602052,radius:9.229212853763597,alpha:.37712495399410595},{angle:6.26621925233645,radius:1.1606904976861743,alpha:.07481263836604102},{angle:4.843768947186235,radius:11.869317412432869,alpha:.30159949378767026},{angle:.8198857932581844,radius:28.681968197778684,alpha:.8741835404309473},{angle:5.819999339454448,radius:9.646018902710708,alpha:.31352350988147815},{angle:3.5697917079349595,radius:28.363030672268852,alpha:.504614458586524},{angle:3.1685151744424553,radius:29.355686829160256,alpha:.3991317887358423},{angle:2.706632662509043,radius:3.593162616225636,alpha:.2946278133946676},{angle:6.15958352016885,radius:16.633151422149048,alpha:.9548752919871186},{angle:1.9550811431839945,radius:15.892532713864023,alpha:.9033340436680706},{angle:2.08295131844792,radius:10.35384865167065,alpha:.6125165895979221},{angle:4.601518046968161,radius:3.518408150728407,alpha:.36013686344854356},{angle:4.51009897967782,radius:12.452107095538192,alpha:.8947321439869018},{angle:3.3782706295233367,radius:6.500778288786375,alpha:.9971400804811548},{angle:4.236553377899336,radius:10.121433812109366,alpha:.5815963065856906},{angle:.6285005831261407,radius:5.544156910135007,alpha:.5705694727454815},{angle:3.1186681488756816,radius:9.183574812936058,alpha:.8177920431334775},{angle:2.516538906497978,radius:20.421409964131797,alpha:.3335282344656654},{angle:.6811068531324246,radius:28.648215758128014,alpha:.4945233544270482},{angle:5.595204219465252,radius:12.104658998992875,alpha:.2223941964867755},{angle:3.446135647570977,radius:16.63438162006062,alpha:.1478963067177932},{angle:2.6496258139745015,radius:26.8808686820231,alpha:.3149813256248144},{angle:2.793355619926763,radius:11.975481315035822,alpha:.8474162589106518},{angle:4.245348059836868,radius:28.870176705415652,alpha:.29479790564168984},{angle:2.6969800185677504,radius:10.900474128776265,alpha:.768273348125837},{angle:4.2595629478647785,radius:17.79636381648034,alpha:.17406059376529504},{angle:4.767394708765845,radius:19.862533528455046,alpha:.10274141331059417},{angle:3.531450902911841,radius:1.4317975043704245,alpha:.5610504208394838},{angle:3.115979361257341,radius:1.4930712884247987,alpha:.4028761486618111},{angle:.5055908519680646,radius:16.245213650731422,alpha:.5874996224294629},{angle:.9384413820800134,radius:17.07429933236625,alpha:.05710872685059076},{angle:5.35895609364817,radius:2.6940742443085575,alpha:.07079587816668376}],[{angle:2.876532847652014,radius:28.89078581833049,alpha:.7134913453422662},{angle:3.9138103210992523,radius:.4500645309715767,alpha:.6215642708106353},{angle:3.150027384613596,radius:28.4951266885954,alpha:.9074080713120005},{angle:4.730007932211933,radius:4.878480453462711,alpha:.7339524416944099},{angle:2.4580229230599575,radius:28.639737977408018,alpha:.5238021716172876},{angle:2.3807629571781126,radius:9.641564041168408,alpha:.9727909314949088},{angle:.3297142267422426,radius:18.289941816476205,alpha:.47449325398677056},{angle:.05716842543886923,radius:12.05452722418578,alpha:.011109518967582055},{angle:6.220545710640468,radius:14.274081677121393,alpha:.26362178090566557},{angle:3.3526960456075563,radius:19.05377416100263,alpha:.2976369141824926},{angle:3.968744087944452,radius:2.532706150607129,alpha:.6852916606009904},{angle:.06045646044039901,radius:5.940841282596865,alpha:.9471354199050497},{angle:5.338543833240888,radius:10.720683716637025,alpha:.9307270429457051},{angle:3.9014687425587895,radius:19.825382888497288,alpha:.23119545586682388},{angle:5.847643734039054,radius:19.112858042986822,alpha:.6670439129717021},{angle:4.5649895215353355,radius:17.88757161633925,alpha:.08585169382989877},{angle:5.179004790327706,radius:28.819192169422784,alpha:.45736078358286525},{angle:1.3189326414823292,radius:2.3582458409634666,alpha:.5775534745658208},{angle:5.704546059685932,radius:14.723893488859897,alpha:.636743332626013},{angle:5.510892075638963,radius:16.6966574352818,alpha:.4183461693653263},{angle:4.223291255457667,radius:10.525916649663294,alpha:.8260666312304541},{angle:3.8474096370898914,radius:8.751919340615238,alpha:.24904762659357127},{angle:.7843056638094592,radius:24.565518893060478,alpha:.37505765927025037},{angle:5.975543708266475,radius:11.963471025932012,alpha:.5365356338363367},{angle:2.115570522172303,radius:17.301590323396944,alpha:.4374225933194844},{angle:3.2457419124089784,radius:17.54546103746675,alpha:.6528870717837059},{angle:5.0554149460818305,radius:9.260845713266157,alpha:.546528343617487},{angle:2.758483727102982,radius:7.256865888590303,alpha:.4861153596920238},{angle:2.411693540648576,radius:15.852851627421117,alpha:.13624903927245913},{angle:.7163733130865817,radius:15.043568902950371,alpha:.5348757605587955},{angle:6.20411036143073,radius:28.85363283726297,alpha:.4689519940833924},{angle:4.465705869863088,radius:.15558171101599294,alpha:.9361547655559195},{angle:.25481225479568786,radius:5.714649553723246,alpha:.8308141148049293},{angle:2.11186213302158,radius:23.38580228211515,alpha:.5283515559400569},{angle:3.7350664075207143,radius:1.8128628901157806,alpha:.15939113479536604},{angle:6.160117702037773,radius:28.813130221324666,alpha:.6205495083690342},{angle:2.760113133794828,radius:24.836419484718732,alpha:.4172817213844988},{angle:.5540155021100622,radius:14.990794709940383,alpha:.8153991372177567},{angle:2.4667390751527325,radius:1.4388825439480035,alpha:.14461616322643134},{angle:1.0799397173884377,radius:9.924750445058654,alpha:.3049112813283341},{angle:1.5684370417920015,radius:11.519891298032896,alpha:.9801573340106124},{angle:2.7032179179778577,radius:19.139954628531374,alpha:.8126199382676387},{angle:5.498058717962101,radius:23.78442399586493,alpha:.407354505149663},{angle:6.12507619681133,radius:4.1186631874558515,alpha:.48805983660457564},{angle:4.9230398891621325,radius:27.826660923617116,alpha:.23510802994399693},{angle:1.1280825708180655,radius:21.32289162182596,alpha:.7304505272700286},{angle:.7996026052916546,radius:12.438740511051254,alpha:.9906685013205103},{angle:.17309382680125257,radius:20.18916012958591,alpha:.26750802211195324},{angle:3.2757413909067172,radius:25.17506751988411,alpha:.9525888713397586},{angle:2.8377044218636214,radius:22.155133150031144,alpha:.43179126088453}]],H=(a,e)=>Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2)),Ta=(a,e,t)=>{const l=Math.abs(H(a,e)),s=Math.abs(H(a,t)),i=Math.abs(H(e,t)),n=(l+s+i)/2;return 2*Math.abs(Math.sqrt(n*(n-l)*(n-s)*(n-i)))/i},G=(a,e,t,l,s,i=!1)=>{a.beginPath(),a.rect(e,t,l,s),i?a.fill():a.stroke()},Oe=(a,e)=>e.x+e.width>a.x&&a.x>e.x&&e.y+e.height>a.y&&a.y>e.y,he=(a,e={},t=document.body)=>{const l=document.createElement(a);return Object.keys(e).forEach(s=>{((i,n)=>i in n)(s,e)&&Reflect.set(l.style,s,e[s])}),t.appendChild(l),l},q=(a,e)=>{if(!((e=e??a.length-1)<0||e>=a.length))return a[e]},ce=(a,e)=>{const t=a.split("."),l=e.split("."),s=Math.max(t.length,l.length);for(;t.length<s;)t.push("0");for(;l.length<s;)t.push("0");for(let i=0;i<s;i++){const n=parseInt(t[i]),r=parseInt(l[i]);if(n>r)return 1;if(n<r)return-1}return 0};class oe{constructor(e,t){g(this,"type");g(this,"layer");this.type=e,this.layer=t}}var W=(a=>(a.Basic="basic",a.Shadow="shadow",a.MultiColor="multiColor",a.Spray="spray",a.Crayon="crayon",a.Bubble="bubble",a))(W||{});class Ca extends oe{constructor(t,l,s,i="basic"){super(T.FREE_DRAW,s);g(this,"positions");g(this,"colors",["#000000"]);g(this,"maxWidth");g(this,"minWidth");g(this,"lineWidths");g(this,"maxSpeed",10);g(this,"minSpeed",.5);g(this,"lastMoveTime",0);g(this,"lastLineWidth");g(this,"rect",{width:0,height:0,x:0,y:0,minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});g(this,"bubbles");g(this,"style");this.positions=[],this.lineWidths=[0],this.colors=t,this.maxWidth=l,this.minWidth=l/2,this.lastLineWidth=l,this.style=i,this.style==="bubble"&&(this.bubbles=[])}addPosition(t){var l,s;if(this.positions.push(t),X(this,t),this.style==="bubble"&&this.bubbles&&this.bubbles.push({radius:(l=2*this.minWidth,s=2*this.maxWidth,Math.floor(Math.random()*(s-l+1))+l),opacity:Math.random()}),this.positions.length>1){const i=this._computedSpeed(this.positions[this.positions.length-2],this.positions[this.positions.length-1]),n=this._computedLineWidth(i);this.lineWidths.push(n)}}_computedSpeed(t,l){const s=H(t,l),i=Date.now(),n=s/(i-this.lastMoveTime);return this.lastMoveTime=i,Number(n.toFixed(5))}_computedLineWidth(t){let l=0;const s=this.minWidth,i=this.maxWidth;return l=t>=this.maxSpeed?s:t<=this.minSpeed?i:i-t/this.maxSpeed*i,l=l*(1/3)+this.lastLineWidth*(2/3),this.lastLineWidth=l,l}}const de=(a,e,t,l)=>{const{positions:s,lineWidths:i}=a,{x:n,y:r}=s[e-1],{x:p,y:h}=s[e];if(t.beginPath(),e==1)t.moveTo(n,r),t.lineTo(p,h);else{const{x:d,y:w}=s[e-2],c=(d+n)/2,u=(w+r)/2,C=(n+p)/2,S=(r+h)/2;t.moveTo(c,u),t.quadraticCurveTo(n,r,C,S)}t.lineWidth=i[e],l==null||l(a,e,t),t.stroke()},ka=(a,e,t)=>{const{x:l,y:s}=a.positions[e];for(let i=0;i<50;i++){const{angle:n,radius:r,alpha:p}=xa[e%5][i];t.globalAlpha=p;const h=r*Math.cos(n),d=r*Math.sin(n);h<2*a.lineWidths[e]&&d<2*a.lineWidths[e]&&h>2*-a.lineWidths[e]&&d>2*-a.lineWidths[e]&&t.fillRect(l+h,s+d,2,2)}},ba=(a,e,t)=>{if(t.beginPath(),a.bubbles){const{x:l,y:s}=a.positions[e];t.globalAlpha=a.bubbles[e].opacity,t.arc(l,s,a.bubbles[e].radius,0,2*Math.PI,!1),t.fill()}},J=(a,e,t,l,s)=>{if(a.rect.width<=10&&e<1||a.rect.height<=10&&t<1)return;te(a),a.positions.forEach(w=>{w.x=w.x*e,w.y=w.y*t,X(a,w)});const{x:i,y:n,width:r,height:p}=a.rect;let h=0,d=0;switch(s){case E.BOTTOM_RIGHT:h=i-l.x,d=n-l.y;break;case E.BOTTOM_LEFT:h=i+r-(l.x+l.width),d=n-l.y;break;case E.TOP_LEFT:h=i+r-(l.x+l.width),d=n+p-(l.y+l.height);break;case E.TOP_RIGHT:h=i-l.x,d=n+p-(l.y+l.height)}te(a),a.positions.forEach(w=>{w.x=w.x-h,w.y=w.y-d,X(a,w)})},te=a=>{a.rect={width:0,height:0,x:0,y:0,minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}},X=(a,e)=>{const{x:t,y:l}=e;let{minX:s,maxX:i,minY:n,maxY:r}=a.rect;t<s&&(s=t),t>i&&(i=t),l<n&&(n=l),l>r&&(r=l);const p={minX:s,maxX:i,minY:n,maxY:r,x:s,y:n,width:i-s,height:r-n};return a.rect=p,p},Sa=a=>{const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=5*a.length,e.height=20,a.forEach((l,s)=>{t.fillStyle=l,t.fillRect(5*s,0,5,20)}),t.createPattern(e,"repeat")},La=(a,e)=>{const t=document.createElement("canvas"),l=t.getContext("2d");return t.width=100,t.height=100,l.fillStyle=a,l.fillRect(0,0,100,100),e&&l.drawImage(e,0,0,100,100),l.createPattern(t,"repeat")},Ae=[{type:T.FREE_DRAW,text:"画笔"},{type:T.ERASER,text:"橡皮擦"},{type:T.SELECT,text:"选择"}],Me={line_1:[{type:W.Basic,text:"单色"},{type:W.Shadow,text:"荧光"},{type:W.MultiColor,text:"多色"}],line_2:[{type:W.Spray,text:"喷雾"},{type:W.Crayon,text:"蜡笔"},{type:W.Bubble,text:"泡泡"}]},le={UNI:"uni",MULTI:"multi"},Ie={lineColor:"_lineColor_1q1kb_1"},_a=Z({name:"ToolPanel",components:{Layer:se},props:["board","toolType","setToolType"],setup(a){const{board:e,toolType:t}=Y(a),l=ve({refresh:0,toastState:!1,showPanel:!0}),s=me(()=>{var i;return((i=e==null?void 0:e.value)==null?void 0:i.currentLineColor)&&e.value.currentLineColor[0].split("#")[1]||""});return{...Y(l),styleSwitch:Me,styles:Ie,CHANGE_COLOR_TYPE:le,CommonWidth:ae,FreeDrawStyle:W,CANVAS_ELE_TYPE:T,typeSwitch:Ae,colorInput:s,changeLineColor:(i,n,r)=>{if(e!=null&&e.value){const p=[...e.value.currentLineColor];p[n]=i;const h=r===le.UNI?[i]:p;e.value.setFreeDrawColor(h),l.refresh++}},deleteLineColor:i=>{if(e!=null&&e.value){const n=[...e.value.currentLineColor];n.splice(i,1),e.value.setFreeDrawColor(n),l.refresh++}},copyColor:()=>{const{copy:i}=we();i(s.value),window.$message.success("复制成功")},undo:()=>{e!=null&&e.value&&e.value.undo()},redo:()=>{e!=null&&e.value&&e.value.redo()},clean:()=>{e!=null&&e.value&&e.value.clean()},saveImage:()=>{e!=null&&e.value&&e.value.saveImage()},setWidth:i=>{if(e.value){switch(t){case T.FREE_DRAW:e.value.setFreeDrawWidth(i);break;case T.ERASER:e.value.setCleanWidth(i)}l.refresh++}},setFreeDrawStyle:i=>{e.value&&(e.value.setFreeDrawStyle(i),l.refresh++)}}}}),Ra={"p-10":""},Pa={flex:""},Oa={"mt-3":""},Aa=o("div",{"font-bold":""},"宽度",-1),Ma={"btn-group":"",flex:"","mt-1":"","w-full":""},Ia={key:0},Wa={"form-control":"","mt-3":""},Fa=o("div",{"font-bold":""}," 颜色",-1),Da={"mt-1":"","w-full":""},za={key:0,flex:"","items-center":""},Ba={flex:"","items-center":"",relative:""},Na=["value","onChange"],Ha={absolute:"","top--10":"","right-0":""},Ya={key:1,flex:"","items-center":"","w-full":""},Ua=o("span",null,"#",-1),Va={key:1},ja={"mt-3":""},Ga=o("div",{"font-bold":""},"效果",-1),qa={flex:"","w-full":"","mb-10":""},Xa={flex:"","w-full":""},Za={"mt-3":""},$a=o("div",{"font-bold":""},"Tool",-1),Ja={flex:"","justify-around":"","items-center":"","m-20":""},Ka=U(_a,[["render",function(a,e,t,l,s,i){var R,F,V;const n=Pe,r=Re,p=xe,h=re,d=_e,w=Le,c=Te,u=Se,C=be,S=ke,I=se;return v(),m("div",{"top-0":"","left-0":"",absolute:"",flex:"","flex-col":"",card:"","shadow-xl":"","overflow-visible":"",class:O(a.showPanel?"p-5":""),style:{"":"#EEF1FF"}},[o("label",null,[L(y(n,{style:{width:"30px",height:"30px"},absolute:"","top--10":"","left--10":"",onClick:e[0]||(e[0]=()=>a.showPanel=!a.showPanel)},null,512),[[P,a.showPanel]]),L(y(r,{size:"20",onClick:e[1]||(e[1]=()=>a.showPanel=!a.showPanel)},null,512),[[P,!a.showPanel]])]),L(o("div",Ra,[o("div",Pa,[(v(!0),m(A,null,M(a.typeSwitch,(f,k)=>(v(),m("div",{key:k,flex:"","flex-1":"","justify-center":"","items-center":""},[y(p,{type:"primary",strong:"",secondary:"",size:"small",class:O(a.toolType==="type"?"btn-active":""),onClick:()=>a.setToolType(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])]))),128))]),L(o("div",null,[o("div",Oa,[Aa,o("div",Ma,[(v(!0),m(A,null,M(a.CommonWidth,(f,k)=>{var b,j;return v(),m("div",{key:k,"flex-1":"","justify-center":"","mr-10":""},[(v(),ne(p,{key:k,ghost:"",class:O(a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?((b=a.board)==null?void 0:b.currentLineWidth)===f:((j=a.board)==null?void 0:j.cleanWidth)===f),onClick:()=>a.setWidth(f)},{default:x(()=>[o("div",{"bg-black":"",style:fe({height:f/2+"px",width:"30px"})},null,4)]),_:2},1032,["class","onClick"]))])}),128))])])],512),[[P,a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW||a.toolType===a.CANVAS_ELE_TYPE.ERASER]]),a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?(v(),m("div",Ia,[o("div",Wa,[Fa,o("div",Da,[((R=a.board)==null?void 0:R.currentFreeDrawStyle)===a.FreeDrawStyle.MultiColor?(v(),m("div",za,[(v(!0),m(A,null,M((F=a.board)==null?void 0:F.currentLineColor,(f,k)=>(v(),m("div",{key:k},[o("div",Ba,[o("input",{type:"color",value:f,onChange:b=>a.changeLineColor(b.target.value,k,"double")},null,40,Na),L(o("div",Ha,[y(h,{size:"10",onClick:()=>a.deleteLineColor(k)},{default:x(()=>[y(n)]),_:2},1032,["onClick"])],512),[[P,a.board.currentLineColor.length>1]])])]))),128)),L(o("div",{flex:"","justify-center":"","items-center":"",onClick:e[2]||(e[2]=()=>a.changeLineColor("#000000",a.board.currentLineColor.length,a.CHANGE_COLOR_TYPE.MULTI))},[y(h,{size:"20"},{default:x(()=>[y(d)]),_:1})],512),[[P,((V=a.board)==null?void 0:V.currentLineColor.length)<6]])])):(v(),m("div",Ya,[o("input",{"w-100":"","mr-20":"",type:"color",onChange:e[3]||(e[3]=f=>a.changeLineColor(f.target.value,1,a.CHANGE_COLOR_TYPE.UNI)),class:O(a.styles.lineColor)},null,34),Ua,L(o("input",{onClick:e[4]||(e[4]=(...f)=>a.copyColor&&a.copyColor(...f)),"onUpdate:modelValue":e[5]||(e[5]=f=>a.colorInput=f),id:"colorInput","w-80":"","focus:outline-none":"","cursor-pointer":"",readOnly:""},null,512),[[Ee,a.colorInput]])]))])])])):ee("",!0),a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?(v(),m("div",Va,[o("div",ja,[Ga,o("div",qa,[(v(!0),m(A,null,M(a.styleSwitch.line_1,(f,k)=>{var b;return v(),m("div",{flex:"","flex-1":"","justify-center":"","items-center":"",key:k},[y(p,{size:"small","flex-grow":"",class:O(((b=a.board)==null?void 0:b.currentFreeDrawStyle)===f.type?"btn-active":""),onClick:()=>a.setFreeDrawStyle(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])])}),128))]),o("div",Xa,[(v(!0),m(A,null,M(a.styleSwitch.line_2,(f,k)=>{var b;return v(),m("div",{flex:"","flex-1":"","justify-center":"","items-center":"",key:k},[y(p,{size:"small","flex-grow":"",class:O(((b=a.board)==null?void 0:b.currentFreeDrawStyle)===f.type?"btn-active":""),onClick:()=>a.setFreeDrawStyle(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])])}),128))])])])):ee("",!0),o("div",Za,[$a,o("div",Ja,[y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.undo},{default:x(()=>[y(w)]),_:1},8,["onClick"])]),default:x(()=>[_(" 撤销 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.redo},{default:x(()=>[y(u)]),_:1},8,["onClick"])]),default:x(()=>[_(" 前进 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.clean},{default:x(()=>[y(C)]),_:1},8,["onClick"])]),default:x(()=>[_(" 删除 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.saveImage},{default:x(()=>[y(S)]),_:1},8,["onClick"])]),default:x(()=>[_(" 保存 ")]),_:1})]),y(I,{board:a.board,refresh:()=>a.refresh++},null,8,["board","refresh"])])],512),[[P,a.showPanel]])],2)}]]);class Qa extends oe{constructor(t,l){super(T.ERASER,l);g(this,"positions");g(this,"cleanWidth");this.positions=[],this.cleanWidth=t}addPosition(t){this.positions.push(t)}}const et=(a,e,t,l,s)=>{const{x:i,y:n}=a,{x:r,y:p}=e,h=s*Math.sin(Math.atan((p-n)/(r-i))),d=s*Math.cos(Math.atan((p-n)/(r-i))),w=i+h,c=n-d,u=i-h,C=n+d,S=r+h,I=p-d,R=r-h,F=p+d;t.save(),t.beginPath(),t.arc(r,p,s,0,2*Math.PI),t.clip(),l(),t.restore(),t.save(),t.beginPath(),t.moveTo(w,c),t.lineTo(S,I),t.lineTo(R,F),t.lineTo(u,C),t.closePath(),t.clip(),l(),t.restore()};var We=(a=>(a.FIRST="first",a.LAST="last",a))(We||{});class at{constructor(e){g(this,"cacheStack");g(this,"step");this.cacheStack=[e],this.step=0}each(e,t="first"){const l=this.getCurrentStack();if(l){if(t==="first")for(let s=0;s<l.length;s++)e==null||e(l[s],s);else if(t==="last")for(let s=l.length-1;s>=0;s--)e==null||e(l[s],s)}}sort(e){const t=q(this.cacheStack);t==null||t.sort(e)}add(e){this.step!==this.cacheStack.length-1&&(this.cacheStack.length=this.step+1);const t=q(this.cacheStack),l=t?[...B.cloneDeep(t),e]:[e];this.cacheStack.push(l),this.step=this.cacheStack.length-1}delete(e,t){this.step!==this.cacheStack.length-1&&(this.cacheStack.length=this.step+1);const l=B.cloneDeep(q(this.cacheStack)),s=(l==null?void 0:l.filter(i=>!(!i||!Object.hasOwn(i,e))&&i[e]!==t))??[];this.cacheStack.push(s),this.step=this.cacheStack.length-1}deleteByIndex(e){this.step!==this.cacheStack.length-1&&(this.cacheStack.length=this.step+1);const t=B.cloneDeep(q(this.cacheStack));t.splice(e,1),this.cacheStack.push(t),this.step=this.cacheStack.length-1}undo(){if(this.step>=0)return this.step--,this.cacheStack[this.step]}redo(){if(this.step<this.cacheStack.length-1)return this.step++,this.cacheStack[this.step]}clean(){this.cacheStack=[],this.step=-1}getCurrentStack(){return q(this.cacheStack,this.step<0?0:this.step)}pushStack(e,t){return this.step!==this.cacheStack.length-1&&(this.cacheStack.length=this.step+1),this.cacheStack.push(B.cloneDeep(e)),t&&(this.cacheStack[this.cacheStack.length-2]=B.cloneDeep(t)),this.step=this.cacheStack.length-1,this.cacheStack}}const ue="PAINT_BOARD_DATA",pe={get(a){if(!a)return null;a=a.toString();const e=localStorage.getItem(a);return e?JSON.parse(e):null},set(a,e){if(!a||!e)return null;localStorage.setItem(a.toString(),JSON.stringify(e))},deleteKey(a){a&&(a=a.toString(),localStorage.removeItem(a))},clear(){localStorage.clear()}};class tt{constructor(e,t){g(this,"stack");g(this,"id");g(this,"current");g(this,"render");const{stack:l=[{id:1,title:"layer1",show:!0}],id:s=1,current:i=1}=t||{};this.stack=l,this.id=s,this.current=i,this.render=e}add(){const e=++this.id;this.stack.unshift({id:e,title:`layer${e}`,show:!0}),this.current=e,this.render()}delete(e){this.stack.length>1&&(this.stack=this.stack.filter(t=>t.id!==e),this.current=this.stack[0].id,this.render())}swap(e,t){[this.stack[e],this.stack[t]]=[this.stack[t],this.stack[e]]}updateTitle(e,t){this.stack.forEach(l=>{l.id===e&&(l.title=t)}),this.render()}updateShow(e,t){this.stack.forEach(l=>{l.id===e&&(l.show=t)}),this.render()}updateCurrent(e){this.current=e,this.render()}}var z=(a=>(a.AUTO="auto",a.POINTER="pointer",a.MOVE="move",a.NE_RESIZE="ne-resize",a.NW_RESIZE="nw-resize",a.SE_RESIZE="se-resize",a.SW_RESIZE="sw-resize",a))(z||{});class lt{constructor(e){g(this,"element");g(this,"type","auto");this.element=e,this.reset()}change(e){this.element.style.cursor=e}reset(){this.element.style.cursor="auto"}}const ge=(a,e="auto")=>{let t=e;switch(a){case E.BODY:t="move";break;case E.BOTTOM_RIGHT:t="se-resize";break;case E.BOTTOM_LEFT:t="sw-resize";break;case E.TOP_LEFT:t="nw-resize";break;case E.TOP_RIGHT:t="ne-resize"}return t};class st extends oe{constructor(t,l,s){super(T.TEXT,t);g(this,"value");g(this,"rect");g(this,"fontSize");this.value=l,this.rect=s,this.fontSize=25}}class it{constructor(){g(this,"rect",{x:0,y:0,width:0,height:0});g(this,"inputEle",null);g(this,"previewEle",null);g(this,"value","")}showTextInput(e){const t={position:"fixed",fontSize:"25px",outline:0,border:0,padding:0,margin:0,lineHeight:"25px",fontFamily:"serif"},l={...t,width:"25px",top:`${e.y}px`,left:`${e.x}px`,backgroundColor:"rgba(0,0,0,0)"},s={...t,height:"25px",top:"-10000px",left:"-10000px",visibility:"hidden",whiteSpace:"nowrap"};this.rect.x=e.x,this.rect.y=e.y;const i=he("input",l),n=he("div",s);return i.addEventListener("input",()=>{if(this.previewEle&&this.inputEle){const r=this.inputEle.value;this.previewEle.textContent=r;const{width:p,height:h}=this.previewEle.getBoundingClientRect();this.inputEle.style.width=`${p}px`,this.rect.width=p,this.rect.height=h,this.value=r}}),i.focus(),this.inputEle=i,this.previewEle=n,i}destroy(){this.inputEle&&(document.body.removeChild(this.inputEle),this.inputEle=null),this.previewEle&&(document.body.removeChild(this.previewEle),this.previewEle=null),this.value="",this.rect={x:0,y:0,width:0,height:0}}}const K=(a,e,t,l)=>{const s=a.rect.width/a.rect.height,i=e/t;if(i<s?t=e/s:i>s&&(e=s*t),!(t<10||e<10)){switch(l){case E.BOTTOM_RIGHT:break;case E.BOTTOM_LEFT:a.rect.x-=e-a.rect.width;break;case E.TOP_LEFT:a.rect.x-=e-a.rect.width,a.rect.y-=t-a.rect.height;break;case E.TOP_RIGHT:a.rect.y-=t-a.rect.height}a.rect.height=t,a.rect.width=e,a.fontSize=a.rect.height}};class nt{constructor(e){g(this,"board");g(this,"mouseHoverElementIndex",-1);g(this,"selectElementIndex",-1);g(this,"startMousePos",{x:0,y:0});g(this,"resizeType",E.NULL);g(this,"tempCache",null);g(this,"isCurrentChange",!1);this.board=e}moveSelectElement(e){var r;const t=this.board.transformPosition(e);let l=z.AUTO;if((r=this.board.history.getCurrentStack())!=null&&r.length){const p=new Set(this.board.layer.stack.reduce((d,w)=>w.show?[...d,w.id]:d,[]));let h=!1;this.board.history.each((d,w)=>{if(d!=null&&d.layer&&p.has(d.layer)){if(h)return;let c=[];switch(d.type){case T.FREE_DRAW:c=d.positions;for(let u=1;u<c.length;u++){const C=H(t,c[u-1]),S=H(t,c[u]),I=Ta(t,c[u-1],c[u]),R=Math.max(c[u-1].x,c[u].x)>=t.x&&t.x>=Math.min(c[u-1].x,c[u].x),F=Math.max(c[u-1].y,c[u].y)>=t.y&&t.y>=Math.min(c[u-1].y,c[u].y);(C<10||S<10||I<10&&R&&F)&&(this.mouseHoverElementIndex=w,l=z.POINTER,h=!0)}break;case T.TEXT:Oe(t,d.rect)&&(this.mouseHoverElementIndex=w,l=z.POINTER,h=!0)}}},We.LAST),h||(this.mouseHoverElementIndex=-1)}if(this.selectElementIndex!==-1)if(this.resizeType!==E.NULL){this.isCurrentChange=!0;const{x:p,y:h}=t,d=this.getCurSelectElement(),w=p-this.startMousePos.x,c=h-this.startMousePos.y;if(l=ge(this.resizeType,l),d.type===T.FREE_DRAW){const u={...d.rect};switch(this.resizeType){case E.BODY:i=w,n=c,te(s=d),s.positions.forEach(C=>{C.x+=i,C.y+=n,X(s,C)});break;case E.BOTTOM_RIGHT:J(d,(u.width+w)/u.width,(u.height+c)/u.height,u,E.BOTTOM_RIGHT);break;case E.BOTTOM_LEFT:J(d,(u.width-w)/u.width,(u.height+c)/u.height,u,E.BOTTOM_LEFT);break;case E.TOP_LEFT:J(d,(u.width-w)/u.width,(u.height-c)/u.height,u,E.TOP_LEFT);break;case E.TOP_RIGHT:J(d,(u.width+w)/u.width,(u.height-c)/u.height,u,E.TOP_RIGHT)}}else if(d.type===T.TEXT)switch(this.resizeType){case E.BODY:d.rect.x+=w,d.rect.y+=c;break;case E.BOTTOM_RIGHT:K(d,d.rect.width+w,d.rect.height+c,E.BOTTOM_RIGHT);break;case E.BOTTOM_LEFT:K(d,d.rect.width-w,d.rect.height+c,E.BOTTOM_LEFT);break;case E.TOP_LEFT:K(d,d.rect.width-w,d.rect.height-c,E.TOP_LEFT);break;case E.TOP_RIGHT:K(d,d.rect.width+w,d.rect.height-c,E.TOP_RIGHT)}this.startMousePos=t,this.board.render()}else{const p=ye(t,this.getCurSelectElement().rect);l=ge(p,l)}var s,i,n;this.board.cursor.change(l)}clickSelectElement(e){const t=this.board.transformPosition(e);if(this.selectElementIndex!==-1){const l=ye(t,this.getCurSelectElement().rect);this.resizeType=l}this.resizeType===E.NULL&&(this.mouseHoverElementIndex!==-1?(this.board.cursor.change(z.MOVE),this.selectElementIndex=this.mouseHoverElementIndex):this.cancelSelectElement()),this.selectElementIndex!==-1&&(this.tempCache=B.cloneDeep(this.board.history.getCurrentStack()),this.startMousePos=t),this.board.render()}getCurSelectElement(){return this.board.history.getCurrentStack()[this.selectElementIndex]}cancelSelectElement(){this.selectElementIndex=-1}deleteSelectElement(){this.selectElementIndex!==-1&&(this.board.history.deleteByIndex(this.selectElementIndex),this.cancelSelectElement(),this.mouseHoverElementIndex=-1,this.resizeType=E.NULL,this.board.render())}}const ye=(a,e)=>{let t=E.NULL;const{x:l,y:s}=a;return Oe(a,e)?t=E.BODY:e.x>l&&l>e.x-10?e.y>s&&s>e.y-10?t=E.TOP_LEFT:e.y+e.height+10>s&&s>e.y+e.height&&(t=E.BOTTOM_LEFT):e.x+e.width+10>l&&l>e.x+e.width&&(e.y>s&&s>e.y-10?t=E.TOP_RIGHT:e.y+e.height+10>s&&s>e.y+e.height&&(t=E.BOTTOM_RIGHT)),t};class rt{constructor(e){g(this,"canvas");g(this,"context");g(this,"history");g(this,"originPosition",{x:0,y:0});g(this,"originTranslate",{x:0,y:0});g(this,"canvasRect",{top:0,left:0});g(this,"layer");g(this,"cursor");g(this,"select");g(this,"version","0.2.2");g(this,"loadMaterialState",!1);g(this,"material",{crayon:null});g(this,"currentMoveEle",null);g(this,"currentLineColor",["#000000"]);g(this,"currentLineWidth",ae.W4);g(this,"currentFreeDrawStyle",W.Basic);g(this,"cleanWidth",ae.W4);this.canvas=e,this.context=e.getContext("2d"),this.initCanvasSize(),this.initOriginPosition();const{top:t,left:l}=e.getBoundingClientRect();this.canvasRect={top:t,left:l},this.cursor=new lt(e),this.select=new nt(this);const{history:s=[],state:i={}}=pe.get(ue)||{};((n,r,p)=>{r!=null&&r.currentLineColor&&(r.currentLineColor=Array.isArray(r==null?void 0:r.currentLineColor)?r.currentLineColor:[r.currentLineColor]),n.forEach(h=>{ce(p,"0.2.0")<0&&(h.type==="freeLine"?h.type=T.FREE_DRAW:h.type==="cleanLine"&&(h.type=T.ERASER),h.type===T.FREE_DRAW&&(te(h),h.positions.forEach(d=>{X(h,d)}))),ce(p,"0.2.1")<0&&h.type===T.FREE_DRAW&&Reflect.has(h,"color")&&(Reflect.set(h,"colors",[Reflect.get(h,"color")]),Reflect.deleteProperty(h,"color"))})})(s,i,(i==null?void 0:i.version)||"0.1.0"),Object.assign(this,{...i}),this.layer=new tt(this.render.bind(this),i==null?void 0:i.layer),this.history=new at(s),this.context.translate(this.originTranslate.x,this.originTranslate.y),this.loadMaterial().then(()=>{this.render()})}loadMaterial(){return new Promise(e=>{this.cleanCanvas();const t=this.transformPosition({x:this.canvas.width/2,y:this.canvas.height/2});this.context.fillText("loading...",t.x,t.y);const l=new Image,s=new URL(""+new URL("../pattern/crayon.png",import.meta.url).href,self.location).href;l.src=s,l.onload=()=>{this.loadMaterialState=!0,this.material.crayon=l,e()}})}initCanvasSize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}initOriginPosition(){this.context.translate(0,0),this.originPosition={x:0,y:0}}recordCurrent(e){let t=null;switch(e){case T.FREE_DRAW:t=new Ca(this.currentLineColor,this.currentLineWidth,this.layer.current,this.currentFreeDrawStyle);break;case T.ERASER:t=new Qa(this.cleanWidth,this.layer.current)}this.select.cancelSelectElement(),t&&(this.history.add(t),this.currentMoveEle=t,this.sortOnLayer())}sortOnLayer(){this.history.sort((e,t)=>this.layer.stack.findIndex(({id:l})=>l===(t==null?void 0:t.layer))-this.layer.stack.findIndex(({id:l})=>l===(e==null?void 0:e.layer)))}currentAddPosition(e){var t;(t=this.currentMoveEle)==null||t.addPosition({x:e.x-this.canvasRect.left-this.originTranslate.x,y:e.y-this.canvasRect.top-this.originTranslate.y}),this.initOriginPosition(),this.render()}dragCanvas(e){const t={x:e.x-this.canvasRect.left,y:e.y-this.canvasRect.top};if(this.cursor.change(z.POINTER),this.originPosition.x&&this.originPosition.y){const l=t.x-this.originPosition.x,s=t.y-this.originPosition.y;this.context.translate(l,s),this.originTranslate={x:l+this.originTranslate.x,y:s+this.originTranslate.y},this.render()}this.originPosition=t}render(){var e;if(this.loadMaterialState){if(this.cleanCanvas(),(e=this.history.getCurrentStack())==null?void 0:e.length){const t=new Set(this.layer.stack.reduce((l,s)=>s.show?[...l,s.id]:l,[]));if(this.history.each(l=>{if(l!=null&&l.layer&&t.has(l.layer)){switch(this.context.save(),l==null?void 0:l.type){case T.FREE_DRAW:((s,i,n)=>{switch(s.save(),s.lineCap="round",s.lineJoin="round",i.style){case"basic":s.strokeStyle=i.colors[0];break;case"shadow":s.shadowColor=i.colors[0],s.strokeStyle=i.colors[0];break;case"bubble":case"spray":s.fillStyle=i.colors[0];break;case"multiColor":s.strokeStyle=Sa(i.colors);break;case"crayon":s.strokeStyle=La(i.colors[0],n.crayon)}for(let r=1;r<i.positions.length;r++)switch(i.style){case"multiColor":case"crayon":case"basic":de(i,r,s);break;case"shadow":de(i,r,s,(p,h,d)=>{d.shadowBlur=p.lineWidths[h]});break;case"spray":ka(i,r,s);break;case"bubble":ba(i,r,s)}s.restore()})(this.context,l,this.material);break;case T.ERASER:((s,i,n)=>{for(let r=0;r<n.positions.length-1;r++)et(n.positions[r],n.positions[r+1],s,i,n.cleanWidth)})(this.context,this.cleanCanvas.bind(this),l);break;case T.TEXT:((s,i)=>{s.save(),s.font=`${i.fontSize}px serif`,s.fillText(i.value,i.rect.x,i.rect.y+.84*i.fontSize),s.restore()})(this.context,l)}this.context.restore()}}),this.select.selectElementIndex!==-1){const l=this.select.getCurSelectElement().rect;((s,i)=>{const{x:n,y:r,width:p,height:h}=i;s.save(),s.strokeStyle="#65CC8A",s.setLineDash([5]),s.lineWidth=2,s.lineCap="round",s.lineJoin="round",G(s,n,r,p,h),s.fillStyle="#65CC8A",G(s,n-10,r-10,10,10,!0),G(s,n+p,r-10,10,10,!0),G(s,n-10,r+h,10,10,!0),G(s,n+p,r+h,10,10,!0),s.restore()})(this.context,l)}}this.cache()}}cache(){const e=this.history.getCurrentStack(),{currentLineColor:t,currentLineWidth:l,cleanWidth:s,originTranslate:i,layer:n,version:r}=this,p={currentLineColor:t,currentLineWidth:l,cleanWidth:s,originTranslate:i,layer:n,version:r};pe.set(ue,{history:e,state:p})}cleanCanvas(e=Number.MAX_SAFE_INTEGER){this.context.clearRect(-e/2,-e/2,e,e)}setFreeDrawWidth(e){e&&(this.currentLineWidth=e)}setFreeDrawColor(e){e&&(this.currentLineColor=e)}setFreeDrawStyle(e){e&&(this.currentFreeDrawStyle=e)}setCleanWidth(e){e&&(this.cleanWidth=e)}undo(){this.select.cancelSelectElement(),this.history.undo(),this.render()}redo(){this.select.cancelSelectElement(),this.history.redo(),this.render()}clean(){this.select.cancelSelectElement(),this.history.clean(),this.render()}saveImage(){const e=this.canvas.toDataURL("image/png"),t=document.createElement("a");t.download="image",t.style.display="none",t.href=e,document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t),this.context.translate(this.originTranslate.x,this.originTranslate.y)}transformPosition(e){return{x:e.x-this.canvasRect.left-this.originTranslate.x,y:e.y-this.canvasRect.top-this.originTranslate.y}}canvasMouseUp(){this.select.isCurrentChange&&this.select.tempCache&&this.history.pushStack(this.history.getCurrentStack(),this.select.tempCache),this.select.isCurrentChange=!1,this.select.tempCache=null,this.select.resizeType=E.NULL,this.currentMoveEle=null,this.initOriginPosition()}addTextElement(e,t){if(e){const l=this.transformPosition(t);t.x=l.x,t.y=l.y;const s=new st(this.layer.current,e,t);this.history.add(s),this.render()}}}const ot=Z({name:"ToolPanel",components:{Layer:se},props:["board","toolType","setToolType"],setup(a){const{board:e,toolType:t}=Y(a),l=ve({refresh:0,toastState:!1,showPanel:!0}),s=me(()=>{var i;return((i=e==null?void 0:e.value)==null?void 0:i.currentLineColor)&&e.value.currentLineColor[0].split("#")[1]||""});return{...Y(l),styleSwitch:Me,styles:Ie,CHANGE_COLOR_TYPE:le,CommonWidth:ae,FreeDrawStyle:W,CANVAS_ELE_TYPE:T,typeSwitch:Ae,colorInput:s,changeLineColor:(i,n,r)=>{if(e!=null&&e.value){const p=[...e.value.currentLineColor];p[n]=i;const h=r===le.UNI?[i]:p;e.value.setFreeDrawColor(h),l.refresh++}},deleteLineColor:i=>{if(e!=null&&e.value){const n=[...e.value.currentLineColor];n.splice(i,1),e.value.setFreeDrawColor(n),l.refresh++}},copyColor:()=>{const{copy:i}=we();i(s.value),window.$message.success("复制成功")},undo:()=>{e!=null&&e.value&&e.value.undo()},redo:()=>{e!=null&&e.value&&e.value.redo()},clean:()=>{e!=null&&e.value&&e.value.clean()},saveImage:()=>{e!=null&&e.value&&e.value.saveImage()},setWidth:i=>{if(e.value){switch(t){case T.FREE_DRAW:e.value.setFreeDrawWidth(i);break;case T.ERASER:e.value.setCleanWidth(i)}l.refresh++}},setFreeDrawStyle:i=>{e.value&&(e.value.setFreeDrawStyle(i),l.refresh++)}}}}),ht={"p-10":""},ct={flex:""},dt={"mt-3":""},ut=o("div",{"font-bold":""},"宽度",-1),pt={"btn-group":"",flex:"","mt-1":"","w-full":""},gt={key:0},yt={"form-control":"","mt-3":""},vt=o("div",{"font-bold":""}," 颜色",-1),mt={"mt-1":"","w-full":""},ft={key:0,flex:"","items-center":""},Et={flex:"","items-center":"",relative:""},wt=["value","onChange"],xt={absolute:"","top--10":"","right-0":""},Tt={key:1,flex:"","items-center":"","w-full":""},Ct=o("span",null,"#",-1),kt={key:1},bt={"mt-3":""},St=o("div",{"font-bold":""},"效果",-1),Lt={flex:"","w-full":"","mb-10":""},_t={flex:"","w-full":""},Rt={"mt-3":""},Pt=o("div",{"font-bold":""},"Tool",-1),Ot={flex:"","justify-around":"","items-center":"","m-20":""},At=U(ot,[["render",function(a,e,t,l,s,i){var R,F,V;const n=Pe,r=Re,p=xe,h=re,d=_e,w=Le,c=Te,u=Se,C=be,S=ke,I=se;return v(),m("div",{"top-0":"","left-0":"",absolute:"",flex:"","flex-col":"",card:"","shadow-xl":"","overflow-visible":"",class:O(a.showPanel?"p-5":""),style:{"":"#EEF1FF"}},[o("label",null,[L(y(n,{style:{width:"30px",height:"30px"},absolute:"","top--10":"","left--10":"",onClick:e[0]||(e[0]=()=>a.showPanel=!a.showPanel)},null,512),[[P,a.showPanel]]),L(y(r,{size:"20",onClick:e[1]||(e[1]=()=>a.showPanel=!a.showPanel)},null,512),[[P,!a.showPanel]])]),L(o("div",ht,[o("div",ct,[(v(!0),m(A,null,M(a.typeSwitch,(f,k)=>(v(),m("div",{key:k,flex:"","flex-1":"","justify-center":"","items-center":""},[y(p,{type:"primary",strong:"",secondary:"",size:"small",class:O(a.toolType==="type"?"btn-active":""),onClick:()=>a.setToolType(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])]))),128))]),L(o("div",null,[o("div",dt,[ut,o("div",pt,[(v(!0),m(A,null,M(a.CommonWidth,(f,k)=>{var b,j;return v(),m("div",{key:k,"flex-1":"","justify-center":"","mr-10":""},[(v(),ne(p,{key:k,ghost:"",class:O(a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?((b=a.board)==null?void 0:b.currentLineWidth)===f:((j=a.board)==null?void 0:j.cleanWidth)===f),onClick:()=>a.setWidth(f)},{default:x(()=>[o("div",{"bg-black":"",style:fe({height:f/2+"px",width:"30px"})},null,4)]),_:2},1032,["class","onClick"]))])}),128))])])],512),[[P,a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW||a.toolType===a.CANVAS_ELE_TYPE.ERASER]]),a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?(v(),m("div",gt,[o("div",yt,[vt,o("div",mt,[((R=a.board)==null?void 0:R.currentFreeDrawStyle)===a.FreeDrawStyle.MultiColor?(v(),m("div",ft,[(v(!0),m(A,null,M((F=a.board)==null?void 0:F.currentLineColor,(f,k)=>(v(),m("div",{key:k},[o("div",Et,[o("input",{type:"color",value:f,onChange:b=>a.changeLineColor(b.target.value,k,"double")},null,40,wt),L(o("div",xt,[y(h,{size:"10",onClick:()=>a.deleteLineColor(k)},{default:x(()=>[y(n)]),_:2},1032,["onClick"])],512),[[P,a.board.currentLineColor.length>1]])])]))),128)),L(o("div",{flex:"","justify-center":"","items-center":"",onClick:e[2]||(e[2]=()=>a.changeLineColor("#000000",a.board.currentLineColor.length,a.CHANGE_COLOR_TYPE.MULTI))},[y(h,{size:"20"},{default:x(()=>[y(d)]),_:1})],512),[[P,((V=a.board)==null?void 0:V.currentLineColor.length)<6]])])):(v(),m("div",Tt,[o("input",{"w-100":"","mr-20":"",type:"color",onChange:e[3]||(e[3]=f=>a.changeLineColor(f.target.value,1,a.CHANGE_COLOR_TYPE.UNI)),class:O(a.styles.lineColor)},null,34),Ct,L(o("input",{onClick:e[4]||(e[4]=(...f)=>a.copyColor&&a.copyColor(...f)),"onUpdate:modelValue":e[5]||(e[5]=f=>a.colorInput=f),id:"colorInput","w-80":"","focus:outline-none":"","cursor-pointer":"",readOnly:""},null,512),[[Ee,a.colorInput]])]))])])])):ee("",!0),a.toolType===a.CANVAS_ELE_TYPE.FREE_DRAW?(v(),m("div",kt,[o("div",bt,[St,o("div",Lt,[(v(!0),m(A,null,M(a.styleSwitch.line_1,(f,k)=>{var b;return v(),m("div",{flex:"","flex-1":"","justify-center":"","items-center":"",key:k},[y(p,{size:"small","flex-grow":"",class:O(((b=a.board)==null?void 0:b.currentFreeDrawStyle)===f.type?"btn-active":""),onClick:()=>a.setFreeDrawStyle(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])])}),128))]),o("div",_t,[(v(!0),m(A,null,M(a.styleSwitch.line_2,(f,k)=>{var b;return v(),m("div",{flex:"","flex-1":"","justify-center":"","items-center":"",key:k},[y(p,{size:"small","flex-grow":"",class:O(((b=a.board)==null?void 0:b.currentFreeDrawStyle)===f.type?"btn-active":""),onClick:()=>a.setFreeDrawStyle(f.type)},{default:x(()=>[_(N(f.text),1)]),_:2},1032,["class","onClick"])])}),128))])])])):ee("",!0),o("div",Rt,[Pt,o("div",Ot,[y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.undo},{default:x(()=>[y(w)]),_:1},8,["onClick"])]),default:x(()=>[_(" 撤销 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.redo},{default:x(()=>[y(u)]),_:1},8,["onClick"])]),default:x(()=>[_(" 前进 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.clean},{default:x(()=>[y(C)]),_:1},8,["onClick"])]),default:x(()=>[_(" 删除 ")]),_:1}),y(c,{trigger:"hover"},{trigger:x(()=>[y(h,{size:"20",onClick:a.saveImage},{default:x(()=>[y(S)]),_:1},8,["onClick"])]),default:x(()=>[_(" 保存 ")]),_:1})]),y(I,{board:a.board,refresh:()=>a.refresh++},null,8,["board","refresh"])])],512),[[P,a.showPanel]])],2)}]]),Mt=Z({name:"NvapCanvas",components:{ToolPanel:At},setup(){const a=new it,e=D(null),t=D();$(()=>{e.value&&(t.value=new rt(e.value),n())});const l=D(T.FREE_DRAW),s=function(c,u){const C=D(!1);$(()=>{window.addEventListener("keydown",S),window.addEventListener("keyup",I)}),ie(()=>{window.removeEventListener("keydown",S),window.removeEventListener("keyup",I)});const S=R=>{R.code===Q.SPACE&&(C.value=!0,c==null||c(!0))},I=R=>{R.code===Q.SPACE&&(C.value=!0,u==null||u(!1))};return C}(()=>{t.value&&(t.value.cursor.change(z.POINTER),t.value.initOriginPosition())},()=>{t.value&&t.value.cursor.reset()}),i=D(null),n=()=>{i.value=document.getElementById("canvas"),i.value.addEventListener("mousedown",p),i.value.addEventListener("mousemove",d),i.value.addEventListener("mouseup",w),i.value.addEventListener("dblclick",h)};(function(c){$(()=>{window.addEventListener("resize",u)}),ie(()=>{window.removeEventListener("resize",u)});const u=()=>{c()}})(()=>{t.value&&(t.value.initCanvasSize(),t.value.context.translate(t.value.originTranslate.x,t.value.originTranslate.y),t.value.render())}),(c=>{$(()=>{window.addEventListener("keydown",u)}),ie(()=>{window.removeEventListener("keydown",u)});const u=C=>{C.code===Q.BACKSPACE&&(c==null||c())}})(()=>{t.value&&t.value.select.deleteSelectElement()});const r=D(!1),p=c=>{if(t.value){const{clientX:u,clientY:C}=c,S={x:u,y:C};switch(a.inputEle&&(t.value.addTextElement(a.value,a.rect),a.destroy()),l.value){case T.SELECT:t.value.select.clickSelectElement(S);break;case T.FREE_DRAW:case T.ERASER:s.value||t.value.recordCurrent(l.value)}r.value=!0}},h=c=>{if(t.value){const{clientX:u,clientY:C}=c,S={x:u,y:C};a.showTextInput(S)}},d=c=>{if(t.value){const{clientX:u,clientY:C}=c;if(s.value&&r.value)t.value.dragCanvas({x:u,y:C});else switch(l.value){case T.SELECT:t.value.select.moveSelectElement({x:u,y:C});break;case T.FREE_DRAW:case T.ERASER:r.value&&t.value.currentAddPosition({x:u,y:C})}}},w=()=>{t.value&&(r.value=!1,t.value.canvasMouseUp())};return{canvasRef:e,toolType:l,handleToolType:c=>{t.value&&(c!==T.SELECT&&t.value.select.cancelSelectElement(),l.value=c,t.value.render())},isPressSpace:s,isMouseDown:r,mouseDown:p,dbClick:h,mouseMove:d,mouseUp:w,board:t}}}),It={relative:"","w-full":"","h-full":""},Wt=["on-mousedown","on-mousemove","on-mouseup","on-dblclick"],Ft=U(Mt,[["render",function(a,e,t,l,s,i){const n=Ka;return v(),m("div",It,[y(n,{board:a.board,toolType:a.toolType,setToolType:a.handleToolType},null,8,["board","toolType","setToolType"]),o("canvas",{id:"canvas",ref:"canvasRef","on-mousedown":a.mouseDown,"on-mousemove":a.mouseMove,"on-mouseup":a.mouseUp,"on-dblclick":a.dbClick,"w-full":"","h-full":""},null,40,Wt)])}]]),jt=U({},[["render",function(a,e){const t=Ft,l=ze;return v(),ne(l,null,{default:x(()=>[y(t)]),_:1})}]]);export{jt as default};
