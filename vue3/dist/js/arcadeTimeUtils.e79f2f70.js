import{i as P}from"./executionError.fb3f283a.js";import{d4 as v,d5 as c,d6 as b,d7 as V,cV as E,d8 as W}from"./index.8fd7165c.js";class l{}var _;l.instance=new v("Etc/UTC"),(_||(_={})).TimeZoneNotRecognised="TimeZoneNotRecognised";const q={[_.TimeZoneNotRecognised]:"Timezone identifier has not been recognised."};class F extends Error{constructor(e,t){super(P(q[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,F)}}let Q=class i{constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}static fromParts(e=0,t=1,n=1,m=0,a=0,r=0,d=0,D){if(isNaN(e)||isNaN(t)||isNaN(n)||isNaN(m)||isNaN(a)||isNaN(r)||isNaN(d))return null;let f=0;const w=c.local(e,t).daysInMonth;n<1&&(f=n-1,n=1),n>w&&(f=n-w,n=w);let u=0;t>12?(u=t-12,t=12):t<1&&(u=t-1,t=1);let h=0;a>59?(h=a-59,a=59):a<0&&(h=a,a=0);let T=0;r>59?(T=r-59,r=59):r<0&&(T=r,r=0);let I=0;d>999?(I=d-999,d=999):d<0&&(I=d,d=0);let s=c.fromObject({day:n,year:e,month:t,hour:m,minute:a,second:r,millisecond:d},{zone:y(D)});return u!==0&&(s=s.plus({months:u})),f!==0&&(s=s.plus({days:f})),h!==0&&(s=s.plus({minutes:h})),T!==0&&(s=s.plus({seconds:T})),I!==0&&(s=s.plus({milliseconds:I})),new i(s)}static get systemTimeZoneCanonicalName(){return Intl.DateTimeFormat().resolvedOptions().timeZone??"system"}static arcadeDateAndZoneToArcadeDate(e,t){const n=y(t);return e.isUnknownTimeZone||n===l.instance?i.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,n):new i(e._date.setZone(t))}static dateJSToArcadeDate(e){return new i(c.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){return new i(c.fromJSDate(e,{zone:t}))}static unknownEpochToArcadeDate(e){return new i(c.fromMillis(e,{zone:l.instance}))}static unknownDateJSToArcadeDate(e){return new i(c.fromMillis(e.getTime(),{zone:l.instance}))}static epochToArcadeDate(e,t="system"){return new i(c.fromMillis(e,{zone:t}))}static dateTimeToArcadeDate(e){return new i(e)}changeTimeZone(e){const t=y(e);return i.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const n=y(t);return e.zone===l.instance||n===l.instance?i.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,n):new i(e.setZone(n))}static nowToArcadeDate(e){return new i(c.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new i(c.utc())}get isSystem(){return this.timeZone==="system"||this.timeZone===i.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===l.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if(this._date.zone.type==="system")return"system";const e=this.zone;return e.type==="fixed"?e.fixed===0?"utc":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new i(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toFormat(e,t){return this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLString(){return"timestamp '"+this._date.toFormat("yyyy-LL-dd HH:mm:ss")+"'"}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new i(this._date.toUTC())}toLocal(){return new i(this._date.toLocal())}toString(){return this.toISOString(!0)}};function y(o){if(o instanceof b)return o;if(o.toLowerCase()==="system")return"system";if(o.toLowerCase()==="utc")return"utc";if(o.toLowerCase()==="unknown")return l.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(o)){const t=V.parseSpecifier("UTC"+(o.startsWith("+")||o.startsWith("-")?"":"+")+o);if(t)return t}const e=v.create(o);if(!e.isValid)throw new F(_.TimeZoneNotRecognised);return e}class R{constructor(){this.dateTimeReferenceMetaData=null,this._fieldTimeZoneIndex={},this._fieldIndex=null,this._ianaPreferred=null,this._ianaTimeInfo=null,this._ianaEditFields=null,this._ianaLayerDateFields=null}static create(e,t){const n=new R;return n.dateTimeReferenceMetaData=t,n._fieldIndex=e instanceof E?e:new E(e),n}static createFromLayer(e){var n,m,a,r;if(!e)return null;if(!e.fieldsIndex)return!e.declaredClass&&e.fields?R.create(e.fields,e):null;const t=new R;return t._fieldIndex=e.fieldsIndex,t.dateTimeReferenceMetaData={timeInfo:((n=e==null?void 0:e.timeInfo)==null?void 0:n.toJSON())??null,editFieldsInfo:((m=e==null?void 0:e.editFieldsInfo)==null?void 0:m.toJSON())??null,dateFieldsTimeReference:((a=e==null?void 0:e.dateFieldsTimeReference)==null?void 0:a.toJSON())??null,preferredTimeReference:((r=e==null?void 0:e.preferredTimeReference)==null?void 0:r.toJSON())??null,datesInUnknownTimezone:(e==null?void 0:e.datesInUnknownTimezone)===!0},t}fieldTimeZone(e){var r,d,D,f,w,u,h,T,I,s,N,Z,k,S,A,M,p,z,U,O,J,L,x;const t=(r=this._fieldIndex)==null?void 0:r.get(e);if(!t||t.type!=="date"&&t.type!=="esriFieldTypeDate")return null;const n=this._fieldTimeZoneIndex[t.name];if(n!==void 0)return n;const m=[{field:(D=(d=this.dateTimeReferenceMetaData)==null?void 0:d.editFieldsInfo)==null?void 0:D.creationDateField,timeReference:(w=(f=this.dateTimeReferenceMetaData)==null?void 0:f.editFieldsInfo)==null?void 0:w.dateFieldsTimeReference,isunknown:((u=this.dateTimeReferenceMetaData)==null?void 0:u.datesInUnknownTimezone)===!0},{field:(T=(h=this.dateTimeReferenceMetaData)==null?void 0:h.editFieldsInfo)==null?void 0:T.editDateField,timeReference:(s=(I=this.dateTimeReferenceMetaData)==null?void 0:I.editFieldsInfo)==null?void 0:s.dateFieldsTimeReference,isunknown:((N=this.dateTimeReferenceMetaData)==null?void 0:N.datesInUnknownTimezone)===!0},{field:(k=(Z=this.dateTimeReferenceMetaData)==null?void 0:Z.timeInfo)==null?void 0:k.startTimeField,timeReference:(A=(S=this.dateTimeReferenceMetaData)==null?void 0:S.timeInfo)==null?void 0:A.timeReference,isunknown:((M=this.dateTimeReferenceMetaData)==null?void 0:M.datesInUnknownTimezone)===!0},{field:(z=(p=this.dateTimeReferenceMetaData)==null?void 0:p.timeInfo)==null?void 0:z.endTimeField,timeReference:(O=(U=this.dateTimeReferenceMetaData)==null?void 0:U.timeInfo)==null?void 0:O.timeReference,isunknown:((J=this.dateTimeReferenceMetaData)==null?void 0:J.datesInUnknownTimezone)===!0}];for(const g of m)if(g.field===t.name){const C=this.convertToIANA(g.timeReference,g.isunknown);return this._fieldTimeZoneIndex[t.name]=C,C}const a=this.convertToIANA((L=this.dateTimeReferenceMetaData)==null?void 0:L.dateFieldsTimeReference,(x=this.dateTimeReferenceMetaData)==null?void 0:x.datesInUnknownTimezone);return this._fieldTimeZoneIndex[t.name]=a,a}convertToIANA(e,t){return t?"unknown":function(n){return n!=null&&n.timeZoneIANA?n==null?void 0:n.timeZoneIANA:n!=null&&n.timeZone?W(n,""):""}(e)}get layerPreferredTimeZone(){var t,n;if(this._ianaPreferred!==null)return this._ianaPreferred;this._ianaPreferred="";const e=(t=this.dateTimeReferenceMetaData)==null?void 0:t.preferredTimeReference;return this._ianaPreferred=this.convertToIANA(e,((n=this.dateTimeReferenceMetaData)==null?void 0:n.datesInUnknownTimezone)===!0),this._ianaPreferred}get layerTimeInfoTimeZone(){var t,n;if(this._ianaTimeInfo!==null)return this._ianaTimeInfo;this._ianaTimeInfo="";const e=(n=(t=this.dateTimeReferenceMetaData)==null?void 0:t.timeInfo)==null?void 0:n.timeReference;return this._ianaTimeInfo=this.convertToIANA(e,!1),this._ianaTimeInfo}get layerEditFieldsTimeZone(){var t,n,m;if(this._ianaEditFields!==null)return this._ianaEditFields;this._ianaEditFields="";const e=(n=(t=this.dateTimeReferenceMetaData)==null?void 0:t.editFieldsInfo)==null?void 0:n.dateFieldsTimeReference;return this._ianaEditFields=this.convertToIANA(e,(m=this.dateTimeReferenceMetaData)==null?void 0:m.datesInUnknownTimezone),this._ianaEditFields}get layerDateFieldsTimeZone(){var t,n;if(this._ianaLayerDateFields!==null)return this._ianaLayerDateFields;this._ianaLayerDateFields="";const e=(t=this.dateTimeReferenceMetaData)==null?void 0:t.dateFieldsTimeReference;return this._ianaLayerDateFields=this.convertToIANA(e,((n=this.dateTimeReferenceMetaData)==null?void 0:n.datesInUnknownTimezone)===!0),this._ianaLayerDateFields}}export{R as T,Q as c,y as u};
