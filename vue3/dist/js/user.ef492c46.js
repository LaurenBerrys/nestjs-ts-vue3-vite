import{_ as B}from"./ComponentPage.vue_vue_type_script_setup_true_name_ComponentPage_lang.16b7ae6a.js";import{f as L,o as U,ad as V}from"./BasicForm.943f4865.js";import{_ as W}from"./BasicModal.e8806bbf.js";import{n as j,_ as A}from"./Table.6259e9bb.js";import{T as F,u as w,g as G,a as K}from"./roles.b3fca30b.js";import{r as b,h as Q,d as D,a as c,o as E,Q as H,V as J,W as t,k as n,l as X,u as s,j as Y}from"./vue.c8caa29a.js";import{g as Z,u as ee,d as ae,c as se}from"./index.3d4ba369.js";import"./AppPage.vue_vue_type_script_setup_true_name_AppPage_lang.22b82fae.js";import"./vue-router.eba62f5a.js";import"./layout.9db98bf3.js";import"./vue-i18n.0f3c4f7c.js";import"./axios.9678a311.js";const oe=[{title:"id",key:"id"},{title:"用户名称",key:"name"},{title:"角色",key:"roles"}],le=(d,r)=>b({width:250,title:"操作",key:"action",fixed:"right",render:i=>Q(F,{style:"button",actions:[{label:"配置角色",onClick:d.bind(null,i),ifShow:()=>!0},{label:"删除",onClick:r.bind(null,i),ifShow:()=>!0}]})}),te=[{field:"name",component:"NInput",label:"账户名",labelMessage:"请输入账户名",giProps:{span:1},componentProps:{placeholder:"请输入账户名",onInput:()=>{}},rules:[{required:!0,message:"请输入账户名",trigger:["blur"]}]},{field:"realName",component:"NInput",label:"昵称",labelMessage:"请输入昵称",giProps:{span:1},componentProps:{placeholder:"请输入昵称",onInput:()=>{}},rules:[{required:!0,message:"请输入昵称",trigger:["blur"]}]},{field:"password",component:"NInput",label:"密码",labelMessage:"请输入密码",giProps:{span:1},componentProps:{placeholder:"请输入密码",onInput:()=>{}},rules:[{required:!0,message:"密码不能为空",trigger:["blur"]}]},{field:"repassed",component:"NInput",label:"确认密码",labelMessage:"请输入确认密码",giProps:{span:1},componentProps:{placeholder:"请输入确认密码",onInput:()=>{}},rules:[{required:!0,message:"确认密码不能为空",trigger:["blur"]}]}],Me=D({__name:"user",setup(d){const r=b({pageSize:10,name:null}),i=async a=>{let e={...s(r),...a};const{data:l}=await Z(e);return l},o=c([]),u=c([]),[f,{openModal:v,closeModal:y,setSubLoading:h}]=w({title:"分配角色"}),[k,{openModal:M,closeModal:P,setSubLoading:ne}]=w({title:"新增用户"}),_=async()=>{(await ee(m.value.id,{roles:o.value})).code==200?(y(),window.$message.success("分配成功")):(window.$message.error("分配失败"),h(!1))},m=c(null),R=async a=>{m.value=a,j(a,"roles")&&u.value.filter(e=>{a.roles.includes(e.value)&&o.value.push(e.value)}),o.value=[...new Set(o.value)],v()};E(async()=>{const{data:a}=await G({pageSize:200});u.value=a.list.map(e=>({label:e.name,value:e.id}))});const I=a=>{window.$dialog.info({title:"提示",content:"您确定想删除此用户吗?",positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{const{code:e,msg:l}=await ae(a.id);e==200?window.$message.success("删除成功"):window.$message.error(l)},onNegativeClick:()=>{window.$message.error("已取消")}})},S=()=>{},[$,{submit:ie,validate:re,getFieldsValue:C,setSchemas:ue}]=K({gridProps:{cols:1},collapsedRows:3,labelWidth:120,layout:"horizontal",showActionButtonGroup:!1,schemas:te}),N=()=>{M()},q=async()=>{const a=C(),{code:e,msg:l}=await se(a);e==200&&(window.$message.success("新增成功"),P())};return(a,e)=>{const l=L,x=A,z=U,g=W,O=V,T=B;return H(),J(T,null,{action:t(()=>[]),default:t(()=>[n(x,{columns:s(oe),request:i,"row-key":p=>p.id,ref:"actionRef",actionColumn:s(le)(R,I),"onUpdate:checkedRowKeys":S},{tableButton:t(()=>[n(l,{type:"primary",size:"small",onClick:N},{default:t(()=>[X("添加用户")]),_:1})]),_:1},8,["columns","row-key","actionColumn"]),n(g,{onRegister:s(f),class:"basicModal",onOnOk:_},{default:t(()=>[n(z,{value:s(o),"onUpdate:value":e[0]||(e[0]=p=>Y(o)?o.value=p:null),multiple:"",options:s(u)},null,8,["value","options"])]),_:1},8,["onRegister"]),n(g,{onRegister:s(k),class:"basicModal",onOnOk:q},{default:t(()=>[n(O,{onRegister:s($)},null,8,["onRegister"])]),_:1},8,["onRegister"])]),_:1})}}});export{Me as default};
