import{_ as S}from"./NvapModal.01430e95.js";import{d as b,a as p,U as X,Z as $,X as h,W as y,k as u,u as l,l as g,x,v as k,a1 as z,j as B}from"./vue.71710d55.js";import{u as E}from"./useModal.11f91f90.js";import{E as F,aX as L,b5 as P,aN as W,n as Z}from"./NvapForm.32ab4956.js";import{u as q}from"./roles.c85b50b3.js";const D={flex:""},G={style:{padding:"0 40px",display:"flex","flex-direction":"column","align-items":"center"}},H={flex:"","justify-between":"","w-360":""},I=b({name:"AssignPermissions"}),se=b({...I,setup(J,{expose:_}){let f;const d=p([]),v=p([]),c=p([]);_({open:(e,s)=>{d.value=e,f=s,c.value=s.code,v.value=d.value.map(a=>a.code),U()}});const[M,{openModal:U,closeModal:K,setSubLoading:j}]=E({title:"分配菜单和按钮权限",style:{width:"800px"}}),r=p(""),m=p(),w=e=>{const s=l(r);for(let a=0;a<d.value.length;a++){const t=d.value[a];if(t.title===s)return t.permissions=e.split(","),!0;if(t.children&&t.children.length&&w(t.children))return!0}},A=e=>{e=e.map(s=>s.trim()),e=[...new Set(e)],c.value=e},C=e=>{v.value=e},N=({option:e})=>({onClick(){r.value=e.title,m.value=F(e.permissions)?e.permissions.join(","):e.permissions??""}}),O=()=>{const e=[],s=n=>{for(let i=0;i<n.length;i++){let o=n[i];o.permissions&&e.push(...o.permissions),o.children&&o.children.length>0&&s(o.children)}};s(d.value),f.code=c.value;const{id:a,code:t}=f;q(a,{code:t,permissions:e}).then(({code:n,msg:i})=>{n==200?(window.$message.success(i),K()):(window.$message(i),j(!1))})};return(e,s)=>{const a=L,t=P,n=W,i=Z,o=S;return X(),$(o,{onRegister:l(M),class:"NvapModal",onOnOk:O},{default:h(()=>[y("div",D,[u(a,{style:{"max-height":"950px",width:"400px",overflow:"hidden"},"block-line":"",cascade:"",checkable:"","key-field":"code","label-field":"title","children-field":"children","virtual-scroll":!0,data:l(d),expandedKeys:l(v),"checked-keys":l(c),"default-checked-keys":l(c),"node-props":N,"onUpdate:checkedKeys":A,"onUpdate:expandedKeys":C},null,8,["data","expandedKeys","checked-keys","default-checked-keys"]),y("div",G,[u(t,{type:"success",italic:!0},{default:h(()=>[g(' 添加按钮权限的时候，尽量取名为，组件名+"-"+按钮名 如：User-AddButton ')]),_:1}),y("div",H,[x(u(n,{bordered:!1,type:"error",style:{"margin-right":"10px"}},{default:h(()=>[g(" 按钮权限 ")]),_:1},512),[[k,l(r)]]),x(u(n,{bordered:!1,type:"success",style:{"margin-bottom":"10px"}},{default:h(()=>[g(z(l(r)),1)]),_:1},512),[[k,l(r)]])]),x(u(i,{size:"small",value:l(m),"onUpdate:value":s[0]||(s[0]=R=>B(m)?m.value=R:null),placeholder:"请输入按钮权限",onChange:w},null,8,["value"]),[[k,l(r)]])])])]),_:1},8,["onRegister"])}}});export{se as _};
